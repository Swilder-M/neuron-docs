# DL/T 645-1997

DL/T645-1997 是中国用于电子能量计量器的技术标准，也被称为《电子能量计量器通信协议》，发布于 1997年。该标准规定了电子能量计量器与数据采集系统之间进行信息交换的通信协议和数据格式。

DL/T645-1997 定义了数据帧的结构、数据字段的内容以及传输能耗和其他相关信息的通信方法。它涵盖了诸多方面，如抄表、负荷控制、事件记录和参数设置等。

该标准为能量计量器与供电公司或其他参与能源监测和管理的实体之间的通信提供了共同的框架。它实现了对能量使用情况进行准确高效的数据采集、计费和分析。

Neuron DLT645-1997 插件支持串口连接和透传的 TCP 连接。

## 添加插件

在 **配置 -> 南向设备**，点击**添加设备**来创建设备节点，输入插件名称，插件类型选择 **DLT645-1997** 启用插件。

## 设备配置

点击插件卡片或插件列，进入**设备配置**页。配置 Neuron 与设备建立连接所需的参数，下表为插件相关的配置项。

| 参数                 | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| **物理链路**         | 选择使用 Serial （串口）或者是 Ethernet（以太网）通信介质。  |
| **连接超时时间**     | 等待设备返回指令响应的时间。                                 |
| **指令重新发送间隔** | 发送读取指令失败后重新发送读指令时间间隔，单位为毫秒。       |
| **指令发送间隔**     | 发送每条读写指令之间的等待时间。某些串口设备在较短时间内接收到连续指令时，可能会丢弃某些指令。 |
| **串口设备**         | 串口模式下，串口设备的路径，如 Linux 系统中 /dev/ttyS0。     |
| **停止位**           | 串口模式下，串口连接参数。                                   |
| **校验位**           | 串口模式下，串口连接参数。                                   |
| **波特率**           | 串口模式下，串口连接参数。                                   |
| **数据位**           | 串口模式下，串口连接参数。                                   |
| **连接模式**         | 以太网模式下，可以选择 Neuron 作为 TCP 的客户端或是服务端。  |
| **IP 地址**          | 以太网模式下，设备的 IP 地址（Neuron 作为客户端）；或是 Neuron 本机的 IP 地址（Neuron 作为服务端），默认可填 0.0.0.0。 |
| **端口**             | 以太网模式下，设备的端口号（Neuron 作为客户端）；或是 Neuron 本机的端口（Neuron 作为服务端）。 |

## 设置组和点位

完成插件的添加和配置后，要建立设备与 Neuron 之间的通信，首先为南向驱动程序添加组和点位。

完成设备配置后，在**南向设备**页，点击设备卡片/设备列进入**组列表**页。点击**创建**来创建组，设定组名称以及采集间隔。完成组的创建后，点击组名称进入**点位列表**页，添加需要采集的设备点位，包括点位地址，点位属性，数据类型等。

公共配置项部分可参考[连接南向设备](../south-devices.md)，本页将介绍支持的数据类型和地址格式部分。

### 数据类型

* UINT32
* UINT64

### 地址格式

> mail_address#DI<sub>1</sub>-DI<sub>0</sub>

* mail_address 代表电表的通信地址。
* DI<sub>1</sub>-DI<sub>0</sub> 代表的是数据标识，所有点位只支持读属性，且用十六进制表示。

例如，123456789012#B6-11，代表通信地址为 123456789012 的电表设备的 A 相电压的值。

:::tip
支持一个节点配置多个通信地址的点位，即单串口的多设备连接。

具体的数据标识对应的数据项名称请参考 DL/T645-1997 行业标准的数据编码表格。

* 数据长度 4 以内，数据类型选择 UINT32；
* 数据长度 8 以内，数据类型选择 UINT64；
* 根据数据格式设置 Decimal 的值，例如数据格式为 XXX.X，则 Decimal 设置为 0.1；
:::

| DI<sub>1</sub>         | DI<sub>0</sub> | 说明                     | 数据类型 | Decimal | 举例                                                         |
| ---------------------- | -------------- | ------------------------ | -------- | ------- | ------------------------------------------------------------ |
| 90 ~ 99                | 10 ~ 6E        | 电能量数据标识           | UINT32   | 0.01    | 90-10 表示（当前）正向有功总电能                             |
| A0 ~ A9                | 10 ~ 6E        | 最大需量数据标识         | UINT32   | 0.0001  | A0-10 表示（当前）正向有功总最大需量                         |
| B0, B1, B4, B5, B8, B9 | 10 ~ 6E        | 最大需量发生时间数据标识 | UINT32   | 0       | B0-10表示（当前）正向有功总最大需量发生时间                  |
| B2, B3, B6             | 10 ~ 15        | 变量数据标识             | -        | -       | B6-11 表示 A 相电压，Decimal 值为 0 <br />B6-21 表示 A 相电流，Decimal 值为 0.01 |
| C0 ~ C5                | 10 ~ AE        | 参变量数据标识           | -        | -       | C0-32 表示表号                                               |

## 数据监控

完成点位的配置后，您可点击 **监控** -> **数据监控**查看设备信息以及反控设备，具体可参考[数据监控](../../../admin/monitoring.md)。